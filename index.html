
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>불량 대분류/중분류 Bar Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* CSS 스타일 생략 */
  </style>
</head>
<body>
  <h2>📊대분류/중분류별[클릭 상세🔎]</h2>
  <canvas id="barChart" width="1100" height="480"></canvas>
  <div id="detailsArea"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log("Chart.js 로드 확인:", typeof Chart !== 'undefined' ? "성공" : "실패");
      if (typeof Chart === 'undefined') {
        document.getElementById('detailsArea').innerHTML = "<div class='detail-box'>❌ Chart.js 로드 실패</div>";
        document.querySelector('.detail-box').style.display = "block";
        return;
      }

      // JSON 데이터를 문자열이 아닌 JavaScript 객체/배열 리터럴로 직접 할당
      const barData = [{"bar_key": "기구작업불량 / Leak", "count": 3, "losstime": 40.0}, {"bar_key": "부품불량 / 외관불량", "count": 1, "losstime": 35.0}, {"bar_key": "설계불량 / 설계오류", "count": 2, "losstime": 21.0}];       // 변경됨: 따옴표 제거, 변수명 변경
      const detailsDict = {"기구작업불량 / Leak": {"GAIA-I DUAL": [["Circulation Line Nut 부 Leak 발생", "Nut 부 재조립", 20.0], ["Circulation 라인 NUT부 Leak 발생", "Nut 부 재조립", 10.0], ["FEMALE CONNECTOR Fitting Nut Leak / HeatExchanger 연결 PCW-R FEMALE CONNECTOR FC08-12R Fitting Nut 체결강", "재체결", 10.0]]}, "부품불량 / 외관불량": {"SWS-I": [["Inlet Plate 각인 누락", "수정 후 입고", 35.0]]}, "설계불량 / 설계오류": {"GAIA-I": [["CDA 공급단 PFA Tube 규격 표기 오류(정상: 6mm / 오류: 1/4\")", "도면 수정", 12.0]], "SWS-I": [["Nozzle Flange와 Male Connector 규격 상이하여 체결 불가", "BOM 및 도면 수정(Fitting Size 변경)", 9.0]]}}; // 변경됨: 따옴표 제거, 변수명 변경

      // JSON 파싱 단계가 더 이상 필요 없음
      // try-catch 블록은 유지하여 다른 잠재적 오류를 잡을 수 있지만, JSON.parse 관련 오류는 발생하지 않아야 함
      if (!barData || !detailsDict) { // 간단한 데이터 유효성 검사
        console.error("데이터 로드 실패: barData 또는 detailsDict가 유효하지 않습니다.");
        document.getElementById('detailsArea').innerHTML = "<div class='detail-box'>❌ 데이터 로드 실패</div>";
        document.querySelector('.detail-box').style.display = "block";
        return;
      }
      
      // 데이터 디버깅
      console.log("barData:", barData);
      const labels = barData.map(r => r['bar_key']);
      const counts = barData.map(r => r['count']);
      console.log("labels:", labels);
      console.log("counts:", counts);

      // (이하 JavaScript 코드 동일하게 사용)
      // ... canvas 확인 ...
      // ... 차트 초기화 (barData와 detailsDict를 직접 사용) ...
      // ... showDetail 함수 (detailsDict를 직접 사용) ...
    });
  </script>
</body>
</html>
