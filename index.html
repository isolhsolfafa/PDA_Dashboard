
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¶ˆëŸ‰ ëŒ€ë¶„ë¥˜/ì¤‘ë¶„ë¥˜ Bar Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .detail-box { display: none; margin: 8px 0 18px 0; padding: 10px; background: #f9f9f9; border-radius: 8px; max-height: 400px; overflow-y: auto; }
    .detail-row { margin: 2px 0; font-size: 13px; }
    .product-title { margin: 9px 0 3px 0; font-weight: bold; font-size: 14px; color: #111; }
    .product-list { margin-bottom: 5px; }
    .pagination { margin-top: 10px; }
    .pagination button { margin: 0 5px; }
  </style>
</head>
<body>
  <h2>ğŸ“ŠëŒ€ë¶„ë¥˜/ì¤‘ë¶„ë¥˜ë³„(í´ë¦­ ìƒì„¸ğŸ”)</h2>
  <canvas id="barChart" width="1100" height="480"></canvas>
  <div id="detailsArea"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Chart.js ë¡œë“œ í™•ì¸
      console.log("Chart.js ë¡œë“œ í™•ì¸:", typeof Chart !== 'undefined' ? "ì„±ê³µ" : "ì‹¤íŒ¨");
      if (typeof Chart === 'undefined') {
        document.getElementById('detailsArea').innerHTML = "<div class='detail-box'>âŒ Chart.js ë¡œë“œ ì‹¤íŒ¨</div>";
        document.querySelector('.detail-box').style.display = "block";
        return;
      }

      // JSON ë°ì´í„° ì‚½ì…
      const barDataJson = '[{"bar_key": "ê¸°êµ¬ì‘ì—…ë¶ˆëŸ‰ / Leak", "count": 28}, {"bar_key": "ê¸°êµ¬ì‘ì—…ë¶ˆëŸ‰ / ì˜¤ì¡°ë¦½", "count": 2}, {"bar_key": "ë¶€í’ˆë¶ˆëŸ‰ / Leak", "count": 3}, {"bar_key": "ë¶€í’ˆë¶ˆëŸ‰ / ì‚¬ì–‘ë¶ˆì¼ì¹˜", "count": 3}, {"bar_key": "ë¶€í’ˆë¶ˆëŸ‰ / ì¡°ë¦½ë¶ˆëŸ‰", "count": 4}, {"bar_key": "ì„¤ê³„ë¶ˆëŸ‰ / ì„¤ê³„ì˜¤ë¥˜", "count": 13}, {"bar_key": "ì‘ì—…ë¶ˆëŸ‰ / ê¸°êµ¬ì‘ì—…", "count": 3}, {"bar_key": "ì‘ì—…ë¶ˆëŸ‰ / ë§ˆë¬´ë¦¬ì‘ì—…", "count": 1}, {"bar_key": "ì‘ì—…ë¶ˆëŸ‰ / ì „ì¥ì‘ì—…", "count": 1}, {"bar_key": "ì „ì¥ì‘ì—…ë¶ˆëŸ‰ / ì˜¤ë°°ì„ ", "count": 1}, {"bar_key": "ì „ì¥ì‘ì—…ë¶ˆëŸ‰ / íŒŒì†", "count": 5}]';
      const detailsDictJson = '{"ê¸°êµ¬ì‘ì—…ë¶ˆëŸ‰ / Leak": {"DRAGON AB": [["N2 MALE ELBOW Teflon ë¶€ì¡± / Main N2 MALE ELBOW PL10-02 Teflon ì¡°ë¦½ë¶€ Leak (Teflon ì½”íŒ… í›„ ì…ê³ íŒŒíŠ¸)", "Teflon ì‘ì—…"]], "DRAGON AB DUAL": [["MALE ELBOW JACO FITTING NUT Leak / Manifold ì—°ê²° MALE ELBOW KQ2H08-03NS Jaco Fitting Nut Leak / ì¬ì¡°ë¦½", "ì¬ì²´ê²°"], ["TUBE SPLICER ì‚½ì…ë¶€ Leak / TUBE SPLICER PU12 Leak / ì¬ì¡°ë¦½ í›„ ì´ìƒ ì—†ìŒ í™•ì¸", "ì¬ì²´ê²°"], ["O2 Line REDUCING UNION TEE Fitting Nut Leak / O2 Line REDUCING UNION TEE RT08-08-04 04 Fitting Nut", "ì¬ì²´ê²°"], ["LNG Line REDUCING UNION TEE Fitting Nut Leak / LNG Line REDUCING UNION TEE RT08-08-06 06Fitting Nut", "ì¬ì²´ê²°"], ["MALE ELBOW JACO FITTING NUT Leak / Manifold ì—°ê²° MALE ELBOW KQ2H08-03NS Jaco Fitting Nut Leak / ì¬ì¡°ë¦½", "ì¬ì²´ê²°"], ["N2 TUBE SPLICER PU 12 ì‚½ì…ë¶€ Leak / Diaphram Valve ê°„ì„­ìœ¼ë¡œ ì¸í•œ í‹€ì–´ì§ ì˜ì‹¬", "ì¬ì²´ê²°"], ["Left Circulation Quench T LIne Teflon ë¶€ Leak ë°œìƒ", "ì¬ì‘ì—…"], ["PCW-S MALE ELBOW Teflon ë¶€ì¡± / Heat Exchanger ì¡°ë¦½ PCW-S INë‹¨ MALE ELBOW ME08-08R í…Œí“¨ë¡ ë¶€ì¡± Leak", "ì¬ì‘ì—…"], ["N2 REDUCING DOUBLE Y UNION 08 ìš°ë ˆíƒ„íŠœë¸Œ ì‚½ì…ë¶€ Leak / REDUCING DOUBLE Y UNION PXG 08-06 08 ìš°ë ˆíƒ„íŠœë¸Œ ì‚½ì…ë¶ˆëŸ‰ Leak", "íŒŒíŠ¸êµì²´"], ["Circulation Quench Line PP Nut Leak", "ì¬ì²´ê²°"], ["O-Ring ë³€í˜• / Swirl Guide í›„ë©´ë¶€ Nozzle ì²´ê²°ë¶€ ì²´ê²°ë³¼íŠ¸ ê³¼ì²´ê²°ë¡œ O-ring P14 FKM ë³€í˜• Leak", "íŒŒíŠ¸êµì²´"], ["MALE ELBOW JACO FITTING NUT ì²´ê²°ë¶ˆëŸ‰ / Manifold ì—°ê²° MALE ELBOW KQ2H08-03NS Jaco Fitting Nut ì²´ê²° ê°•ë„ ë¶€ì¡± Lea", "ì¬ì²´ê²°"], ["O-Ring ë³€í˜• / Swirl Guide ì „ë©´ë¶€ Nozzle ì²´ê²°ë¶€ ì²´ê²°ë³¼íŠ¸ ê³¼ì²´ê²°ë¡œ O-ring P14 FKM ë³€í˜• Leak", "íŒŒíŠ¸êµì²´"], ["O-Ring ì”¹í˜ / Bunner GAS Nozzle Top ì²´ê²°ë¶€ O-Ring AS568 119 FKM ì”¹í˜ Leak", "íŒŒíŠ¸êµì²´"], ["O-Ring ë³€í˜• / Swirl Guide ì „ë©´ë¶€ Nozzle ì²´ê²°ë¶€ ì²´ê²°ë³¼íŠ¸ ê³¼ì²´ê²°ë¡œ O-ring P14 FKM ë³€í˜• Leak", "íŒŒíŠ¸êµì²´"], ["O-Ring ë³€í˜• / Swirl Guide í›„ë©´ë¶€ Nozzle ì²´ê²°ë¶€ ì²´ê²°ë³¼íŠ¸ ê³¼ì²´ê²°ë¡œ O-ring P14 FKM ë³€í˜• Leak", "íŒŒíŠ¸êµì²´"]], "DRAGON LE DUAL": [["MALE ELBOW JACO FITTING NUT ë‚˜ì‚¬ì‚°íŒŒì† / Manifold ì—°ê²° MALE ELBOW KQ2H08-03NS Jaco Fitting Nut ê³¼ì²´ê²°ë¡œ ë‚˜ì‚¬ì‚°íŒŒì†", "íŒŒíŠ¸êµì²´"]], "GAIA-I": [["PCW Bunner ì—°ê²°ë¶€ UNION ELBOW Fitting Nut LEAK/UNION ELBOW 04 Fitting Nut ì²´ê²°ê°•ë„ë¶€ì¡± Leak", "ì¬ì²´ê²°"]], "GAIA-I DUAL": [["CDA ì£¼ì… BULKHEAD UNION í•˜ë‹¨ë¶€ Fitting Nut Leak / CDA ì£¼ì… BULKHEAD UNION BU 08 í•˜ë‹¨ë¶€ Fitting Nut Leak", "ì¬ì²´ê²°"], ["MALE ELBOW JACO Fitting Nut Leak / MALE ELBOW 40-8-6-K-PG Fitting Nut Leak / ì´ë™ ë° ì¡°ë¦½ê³¼ì • ì¤‘ í’€ë¦¼ ì˜ì‹¬", "ì¬ì²´ê²°"], ["UNION TEE Fitting Nut Leak / UNION TEE 70-8-K-PG í•˜ë‹¨ JACO Fitting Nut ì²´ê²°ê°•ë„ë¶€ì¡± , ê°€ì•• ì‹œ íƒˆê±° í›„ ì›ë³µëˆ„ë½", "ì¬ì²´ê²°"], ["O-Ring ì”¹í˜ /Temp Sensor SOKET ì²´ê²° O-RING AS568 015 ì”¹í˜ Leak", "íŒŒíŠ¸êµì²´"], ["UNION ELBOW Fitting Nut Leak/ BYPASS#4 PE140 PFA íŠœë¸Œ ì‚½ì…ë¶€ Fitting Nut ì²´ê²°ê°•ë„ë¶€ì¡± Leak", "ì¬ì²´ê²°"], ["Cir\' Water Quench Line Nut ë¶€ ë¯¸ì„¸ Water Leak ë°œìƒ", "ì¬ì‘ì—…"], ["REDUCING UNION TEE(06M) Fitting Nut Leak / N.PE140 PFA íŠœë¸Œ ì‚½ì…ë¶€ Fitting Nut ì²´ê²°ê°•ë„ë¶€ì¡± Leak", "ì¬ì²´ê²°"], ["CDA Male Connector Teflon ë¶€ì¡± / Main CDA Male Connector í…Œí“¨ë¡ ë¶€ Leak / íŒŒíŠ¸ í…Œí“¨ë¡  ë°€ë¦¼ ì˜ì‹¬ , í…Œí“¨ë¡  ì¶”ê°€ì‘ì—… í›„ ì¬ì¡°ë¦½", "Teflon ì‘ì—…"]], "GAIA-P DUAL": [["Circulation Line Teflon ë¶€ Leak", "Teflon ì¬ì‘ì—…"]]}, "ê¸°êµ¬ì‘ì—…ë¶ˆëŸ‰ / ì˜¤ì¡°ë¦½": {"GAIA-P": [["CDA ë ˆê·¤ë ˆì´í„° íŠœë¹™ êµì°¨ ì—°ê²°(In, Out)", "ì¬ì—°ê²°"]], "GAIA-P DUAL": [["Right Torch Voltage Hunting ë°œìƒìœ¼ë¡œ Burning ë¶ˆê°€(Torch ë‚´ Anode O-Ring íŒŒì†)", "O-Ring êµì²´ í›„ ì¬ì¡°ë¦½"]]}, "ë¶€í’ˆë¶ˆëŸ‰ / Leak": {"DRAGON AB": [["Tank ê°€ê³µë©´ ìƒíƒœ ë¶ˆëŸ‰ìœ¼ë¡œ Leak ë°œìƒ", "í˜„ì¥ ì¡°ì¹˜(ê°€ê³µë©´ ì¬ì‘ì—… ë° O-ring êµì²´)"]], "GAIA-I DUAL": [["Right Cir Water Filter ìƒë¶€ ìš©ì ‘ë¶€ Leak", "ëŒ€ì²´í’ˆ êµì²´"], ["Left Circulation Manifold ìš©ì ‘ë¶€ Leak ë°œìƒ", "ëŒ€ì²´í’ˆ ì¡°ì¹˜"]]}, "ë¶€í’ˆë¶ˆëŸ‰ / ì‚¬ì–‘ë¶ˆì¼ì¹˜": {"GAIA-I DUAL": [["ê°ì¸ ëˆ„ë½", "ìˆ˜ì • í›„ ì…ê³ "], ["ìƒì´í•œ í’ˆë²ˆìœ¼ë¡œ ê°ì¸", "ëŒ€ì²´í’ˆ êµì²´"]], "GAIA-P": [["ì ‘ì§€ë„ˆíŠ¸ 1 Point ìš©ì ‘ ëˆ„ë½", "í˜„ì¥ ì¡°ì¹˜(ì ‘ì§€ë„ˆíŠ¸ ìš©ì ‘)"]]}, "ë¶€í’ˆë¶ˆëŸ‰ / ì¡°ë¦½ë¶ˆëŸ‰": {"DRAGON AB DUAL": [["Heating Jacket Cable Label ëˆ„ë½", "ëŒ€ì²´í’ˆ ì…ê³ "]], "DRAGON AB SINGLE": [["Nozzle ë°©í–¥ í‹€ì–´ì ¸ Flangeì™€ ìˆ˜ì§ìœ¼ë¡œ ì²´ê²°ë˜ì§€ ì•ŠìŒ", "ëŒ€ì²´í’ˆ êµì²´"]], "GAIA-I DUAL": [["ë‚˜ì‚¬ì‚° ì²´ê²° ë¶ˆëŸ‰", "ëŒ€ì²´í’ˆ êµì²´"]], "GAIA-P DUAL": [["Bolt ì²´ê²° ë¶ˆê°€", "ëŒ€ì²´í’ˆ êµì²´"]]}, "ì„¤ê³„ë¶ˆëŸ‰ / ì„¤ê³„ì˜¤ë¥˜": {"DRAGON-DUAL": [["ë„ë©´ å…§ ìš©ì ‘ ê¸°í˜¸ ë¯¸ í‘œê¸°_ìš©ì ‘ ë¹„ë“œ ê°„ì„­ìœ¼ë¡œ ì²´ê²° ë¶ˆê°€", "ë„ë©´ ìˆ˜ì •"]], "GAIA-I": [["N2 Utility Line Elbow Fitting ì ìš© ì˜¤ë¥˜", "BOM ë° ë„ë©´ ìˆ˜ì •"], ["CDA Regulator ê³ ì • Bracket ê¸°ì¡´ ë„ë©´ê³¼ ìƒì´", "ë„ë©´ ìˆ˜ì •"], ["Interlock Relay Tag Name ì˜¤ë¥˜(ì •ìƒ: KRF800 / ì˜¤ë¥˜: KRF480)", "ë„ë©´ ìˆ˜ì •"], ["Level Sensor Spray Elbow Fitting ì ìš© ëˆ„ë½", "BOM ë³€ê²½(Elbow Fitting ì¶”ê°€)"]], "GAIA-I DUAL": [["Inlet Line ì—°ê²°ë¶€ Center O-ring ì ìš© ëˆ„ë½", "BOM ìˆ˜ì •"], ["Union Y Fitting ì‚¬ì–‘ ì ìš© ì˜¤ë¥˜(ì •ìƒ: SMC / ì˜¤ë¥˜: ìƒì•„)", "ë„ë©´ ìˆ˜ì •"], ["ì „ì¥ë„ë©´ å…§ Sol Valve êµ¬ì„± ì˜¤ë¥˜(ì •ìƒ: ì „ê¸° Sol V/V, ì˜¤ë¥˜: ê³µì•• Sol V/V)", "ë„ë©´ ìˆ˜ì •"], ["Y-Reactor í’ˆë²ˆ êµ¬ì„± ì˜¤ë¥˜(Left, Right í’ˆë²ˆ ë™ì¼)", "BOM ë³€ê²½(Left Y-Reactor í’ˆë²ˆ ë³€ê²½)"], ["P&ID å…§ Waste Gas Line Ball Valve í‘œê¸° ì˜¤ë¥˜", "P&ID ìˆ˜ì •(PE110, 130 ì‚­ì œ)"]], "GAIA-P DUAL": [["Ball Valve Plug ìˆ˜ëŸ‰ 1ea ë¶€ì¡±", "BOM ìˆ˜ì •"], ["End Clamp BOM ìˆ˜ëŸ‰ ì˜¤ë¥˜(ì •ìƒ: 87ea / ì˜¤ë¥˜: 83ea)", "BOM ìˆ˜ì •"], ["Cabinet CDA Line ë‹¤ì—°ì¡° Sol ê³ ì • Tap ìœ„ì¹˜ ì„¤ì • ì˜¤ë¥˜", "ë„ë©´ ìˆ˜ì •"]]}, "ì‘ì—…ë¶ˆëŸ‰ / ê¸°êµ¬ì‘ì—…": {"DRAGON AB DUAL": [["Left, Right O2 MFC Sticker ì˜¤ë¶€ì°©(FD312<>FD322)", ""]], "GAIA-P": [["N2 ì†Œí™”ì‹œìŠ¤í…œ Sticker ë° ë°©í–¥ì‹ë³„ Sticker ëˆ„ë½", "ì¬ì‘ì—…"]], "GAIA-P DUAL": [["Heating Jacket ë¶€ë¶„ ì†ìƒ", "ì‹ ê·œ ì œì‘ í›„ Line ì„œ ì¡°ì¹˜ ì˜ˆì •"]]}, "ì‘ì—…ë¶ˆëŸ‰ / ë§ˆë¬´ë¦¬ì‘ì—…": {"GAIA-I DUAL": [["Flow Sensor íŒŒíŠ¸ í¬ì¥ì¤‘ íŒŒì†", ""]]}, "ì‘ì—…ë¶ˆëŸ‰ / ì „ì¥ì‘ì—…": {"DRAGON AB": [["Tower Lamp Sticker ëˆ„ë½", "Sticker ë¶€ì°©"]]}, "ì „ì¥ì‘ì—…ë¶ˆëŸ‰ / ì˜¤ë°°ì„ ": {"DRAGON AB DUAL": [["Left, Right O2 MFC Connector ì˜¤ì²´ê²°(O2 Flow ë¶ˆê°€/FD312<>FD322)", "Connector ì¬ì²´ê²°"]]}, "ì „ì¥ì‘ì—…ë¶ˆëŸ‰ / íŒŒì†": {"DRAGON AB DUAL": [["O-Ring ì¡°ë¦½ ë¶ˆëŸ‰ / Level Sensor ë‚´ë¶€ O-Ring G50 ì¡°ë¦½ ë¶ˆëŸ‰ìœ¼ë¡œ Leak", "ì¬ì²´ê²°"], ["O-Ring ì¡°ë¦½ ë¶ˆëŸ‰ / Level Sensor ë‚´ë¶€ O-Ring ì¡°ë¦½ ë¶ˆëŸ‰ìœ¼ë¡œ Leak", "ì¬ì²´ê²°"]], "DRAGON LE DUAL": [["O-Ring ì¡°ë¦½ ë¶ˆëŸ‰ / Level Sensor ë‚´ë¶€ O-Ring G50 ì¡°ë¦½ ë¶ˆëŸ‰ìœ¼ë¡œ Leak", "ì¬ì²´ê²°"], ["O-Ring ì¡°ë¦½ ë¶ˆëŸ‰ / Level Sensor ë‚´ë¶€ O-Ring G50 ì¡°ë¦½ ë¶ˆëŸ‰ìœ¼ë¡œ Leak", "ì¬ì²´ê²°"]], "GAIA-I DUAL": [["Level Sensor ì²´ê²° Nut Leak / Level Sensor ì²´ê²° Nut G2 1/4 PP(WHITE) Leak / TMS ëª¨ë“ˆ ê°€ì••ì‹œ ì´ìƒì—†ìŒ í™•ì¸, ê°€ì••ê³µì • ì¬ì²´ê²°", "ì¬ì²´ê²°"]]}}';

      // JSON íŒŒì‹±
      let barData, detailsDict;
      try {
        barData = JSON.parse(barDataJson);
        detailsDict = JSON.parse(detailsDictJson);
      } catch (e) {
        console.error("JSON íŒŒì‹± ì˜¤ë¥˜:", e);
        console.log("barDataJson:", barDataJson);
        console.log("detailsDictJson:", detailsDictJson);
        document.getElementById('detailsArea').innerHTML = "<div class='detail-box'>âŒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: " + e.message + "</div>";
        document.querySelector('.detail-box').style.display = "block";
        return;
      }

      // ë°ì´í„° ë””ë²„ê¹…
      console.log("barData:", barData);
      const labels = barData.map(r => r['bar_key']);
      const counts = barData.map(r => r['count']);
      console.log("labels:", labels);
      console.log("counts:", counts);

      // canvas í™•ì¸
      const ctx = document.getElementById('barChart').getContext('2d');
      console.log("canvas ìš”ì†Œ:", ctx);
      if (!ctx) {
        console.error("canvas ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        document.getElementById('detailsArea').innerHTML = "<div class='detail-box'>âŒ ì°¨íŠ¸ ë Œë”ë§ ì‹¤íŒ¨</div>";
        document.querySelector('.detail-box').style.display = "block";
        return;
      }

      // ì°¨íŠ¸ ì´ˆê¸°í™”
      const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'ê±´ìˆ˜',
            data: counts,
            backgroundColor: 'rgba(0,123,255,0.6)'
          }]
        },
        options: {
          responsive: false,
          onClick: (evt, el) => {
            if (el.length > 0) {
              const idx = el[0].index;
              const key = labels[idx];
              showDetail(key, labels[idx]);
            }
          },
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { ticks: { autoSkip: false, maxRotation: 70, minRotation: 20, font: { size: 10 } } }
          }
        }
      });

      function showDetail(key, label, page = 1, perPage = 10) {
        const area = document.getElementById('detailsArea');
        if (!(key in detailsDict)) {
          area.innerHTML = `<div class="detail-box">âŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤: ${label}</div>`;
          document.querySelector('.detail-box').style.display = "block";
          return;
        }
        const prodMap = detailsDict[key];
        let prodKeys = Object.keys(prodMap);
        const start = (page - 1) * perPage;
        const end = start + perPage;
        let html = `<div class="detail-box"><strong>ìƒì„¸ [${label}]</strong><br>`;
        let anyProduct = false;
        prodKeys.slice(start, end).forEach(prod => {
          html += `<div class="product-title">ğŸ”¹ ${prod}</div>`;
          const plist = prodMap[prod];
          if (plist.length === 0) {
            html += '<div class="detail-row">ë°ì´í„° ì—†ìŒ</div>';
          } else {
            html += '<div class="product-list">';
            plist.forEach(row => {
              html += `<div class="detail-row">â–ªï¸ ${row[0]} / <span style="color:#888;">${row[1]}</span></div>`;
            });
            html += '</div>';
            anyProduct = true;
          }
        });
        if (!anyProduct) html += '<div class="detail-row">ë°ì´í„° ì—†ìŒ</div>';
        if (prodKeys.length > perPage) {
          html += `<div class="pagination">`;
          if (page > 1) html += `<button onclick="showDetail('${key}', '${label}', ${page - 1})">ì´ì „</button>`;
          if (end < prodKeys.length) html += `<button onclick="showDetail('${key}', '${label}', ${page + 1})">ë‹¤ìŒ</button>`;
          html += `</div>`;
        }
        html += '</div>';
        area.innerHTML = html;
        document.querySelector('.detail-box').style.display = "block";
      }
    });
  </script>
</body>
</html>
